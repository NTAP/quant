# This is a config file for vagrant (https://www.vagrantup.com/),
# which will install an ubuntu/xenial64 VM, inside which we'll build
# and run the proto-quic quic_server (https://github.com/google/proto-quic)
# to test our implementation against.

Vagrant.configure("2") do |config|
  # OS to use for the VM
  config.vm.box = "ubuntu/xenial64"
  config.vm.box_version = "20160930.0.0"

  # don't always check for box updates
  config.vm.box_check_update = false

  # hardware configuration of the VM
  config.vm.provider "virtualbox" do |vb|
    vb.gui = false
    vb.memory = "1024"
    vb.cpus = 1
    vb.linked_clone = true
    vb.customize [ # better clock synchronization
      "guestproperty", "set", :id,
      "/VirtualBox/GuestAdd/VBoxService/--timesync-set-threshold", 10000
    ]
 end

  # mount the main quickie directory as well
  config.vm.synced_folder "..", "/quickie"

  # quic_server will listen on 127.0.0.1:6121 inside the VM
  config.vm.network "forwarded_port", guest: 6121, host: 6121, protocol: "udp"

  # apply some fixes to the VM OS, update it, and install some tools
  config.vm.provision "shell", inline: <<-SHELL
    export DEBIAN_FRONTEND=noninteractive
    # update the box
    # apt-get update
    # apt-get -y dist-upgrade

    # install some tools that are needed for the tests, or that I often use
    apt-get -y install htop silversearcher-ag daemon cmake libnss3-dev libev-dev
  SHELL
end
