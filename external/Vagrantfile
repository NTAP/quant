# This is a config file for vagrant (https://www.vagrantup.com/),
# which will install an ubuntu/xenial64 VM, inside which we'll build
# and run the proto-quic quic_server (https://github.com/google/proto-quic)
# to test our implementation against.

Vagrant.configure("2") do |config|
  # OS to use for the VM
  config.vm.box = "ubuntu/xenial64"

  # don't always check for box updates
  config.vm.box_check_update = false

  # hardware configuration of the VM
  config.vm.provider "virtualbox" do |vb|
    vb.gui = false
    vb.memory = "1024"
    vb.cpus = 1
    vb.linked_clone = true
  end

  # quic_server will listen on 127.0.0.1:6121 inside the VM
  config.vm.network "forwarded_port", guest: 6121, host: 6121, protocol: "udp"

  # apply some fixes to the VM OS, update it, and install some tools
  config.vm.provision "shell", inline: <<-SHELL
    # fix "mesg: ttyname failed: Inappropriate ioctl for device"; see
    # https://github.com/mitchellh/vagrant/issues/1673
    sed -i 's/^mesg n/tty -s \\&\\& mesg n/g' /root/.profile

    # fix exmpty resolv.conf issue in the current ubuntu/xenial64 box; see
    # https://bugs.launchpad.net/cloud-images/+bug/1621393/comments/5
    ln -nsf ../run/resolvconf/resolv.conf /etc/resolv.conf

    # update the box
    # apt-get update
    # apt-get -y dist-upgrade

    # install some tools I often use
    apt-get -y install htop silversearcher-ag
  SHELL
end
